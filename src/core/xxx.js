const mockGitlabIssues = [
  {
    "id": 176791526,
    "iid": 2,
    "project_id": 75943662,
    "title": "Install Software Pre-requisites",
    "description": null,
    "state": "opened",
    "created_at": "2025-11-09T13:03:22.035Z",
    "updated_at": "2025-11-09T13:11:01.351Z",
    "closed_at": null,
    "closed_by": null,
    "labels": [
      "BAU"
    ],
    "milestone": null,
    "assignees": [
      {
        "id": 5114354,
        "username": "nantha-a",
        "public_email": "",
        "name": "Nanthagopal A",
        "state": "active",
        "locked": false,
        "avatar_url": "https://secure.gravatar.com/avatar/3322a75d281d1a86d9263a6ee9b32089f21e2e679112f2216aa936fe6ea3ae81?s=80&d=identicon",
        "web_url": "https://gitlab.com/nantha-a"
      }
    ],
    "author": {
      "id": 5114354,
      "username": "nantha-a",
      "public_email": "",
      "name": "Nanthagopal A",
      "state": "active",
      "locked": false,
      "avatar_url": "https://secure.gravatar.com/avatar/3322a75d281d1a86d9263a6ee9b32089f21e2e679112f2216aa936fe6ea3ae81?s=80&d=identicon",
      "web_url": "https://gitlab.com/nantha-a"
    },
    "type": "TASK",
    "assignee": {
      "id": 5114354,
      "username": "nantha-a",
      "public_email": "",
      "name": "Nanthagopal A",
      "state": "active",
      "locked": false,
      "avatar_url": "https://secure.gravatar.com/avatar/3322a75d281d1a86d9263a6ee9b32089f21e2e679112f2216aa936fe6ea3ae81?s=80&d=identicon",
      "web_url": "https://gitlab.com/nantha-a"
    },
    "user_notes_count": 0,
    "merge_requests_count": 0,
    "upvotes": 0,
    "downvotes": 0,
    "due_date": null,
    "confidential": false,
    "discussion_locked": null,
    "issue_type": "task",
    "web_url": "https://gitlab.com/cloudopsedge/tickets/support-infra/-/work_items/2",
    "time_stats": {
      "time_estimate": 0,
      "total_time_spent": 0,
      "human_time_estimate": null,
      "human_total_time_spent": null
    },
    "task_completion_status": {
      "count": 0,
      "completed_count": 0
    },
    "blocking_issues_count": 0,
    "has_tasks": true,
    "task_status": "",
    "_links": {
      "self": "https://gitlab.com/api/v4/projects/75943662/issues/2",
      "notes": "https://gitlab.com/api/v4/projects/75943662/issues/2/notes",
      "award_emoji": "https://gitlab.com/api/v4/projects/75943662/issues/2/award_emoji",
      "project": "https://gitlab.com/api/v4/projects/75943662",
      "closed_as_duplicate_of": null
    },
    "references": {
      "short": "#2",
      "relative": "#2",
      "full": "cloudopsedge/tickets/support-infra#2"
    },
    "severity": "UNKNOWN",
    "moved_to_id": null,
    "imported": false,
    "imported_from": "none",
    "service_desk_reply_to": null
  },
  {
    "id": 176791520,
    "iid": 1,
    "project_id": 75943662,
    "title": "Backstage Integration",
    "description": "",
    "state": "opened",
    "created_at": "2025-11-09T13:02:59.296Z",
    "updated_at": "2025-11-09T13:12:54.632Z",
    "closed_at": null,
    "closed_by": null,
    "labels": [
      "Hold",
      "Platform"
    ],
    "milestone": null,
    "assignees": [
      {
        "id": 5114354,
        "username": "nantha-a",
        "public_email": "",
        "name": "Nanthagopal A",
        "state": "active",
        "locked": false,
        "avatar_url": "https://secure.gravatar.com/avatar/3322a75d281d1a86d9263a6ee9b32089f21e2e679112f2216aa936fe6ea3ae81?s=80&d=identicon",
        "web_url": "https://gitlab.com/nantha-a"
      }
    ],
    "author": {
      "id": 5114354,
      "username": "nantha-a",
      "public_email": "",
      "name": "Nanthagopal A",
      "state": "active",
      "locked": false,
      "avatar_url": "https://secure.gravatar.com/avatar/3322a75d281d1a86d9263a6ee9b32089f21e2e679112f2216aa936fe6ea3ae81?s=80&d=identicon",
      "web_url": "https://gitlab.com/nantha-a"
    },
    "type": "ISSUE",
    "assignee": {
      "id": 5114354,
      "username": "nantha-a",
      "public_email": "",
      "name": "Nanthagopal A",
      "state": "active",
      "locked": false,
      "avatar_url": "https://secure.gravatar.com/avatar/3322a75d281d1a86d9263a6ee9b32089f21e2e679112f2216aa936fe6ea3ae81?s=80&d=identicon",
      "web_url": "https://gitlab.com/nantha-a"
    },
    "user_notes_count": 0,
    "merge_requests_count": 0,
    "upvotes": 0,
    "downvotes": 0,
    "due_date": null,
    "confidential": false,
    "discussion_locked": null,
    "issue_type": "issue",
    "web_url": "https://gitlab.com/cloudopsedge/tickets/support-infra/-/issues/1",
    "time_stats": {
      "time_estimate": 0,
      "total_time_spent": 0,
      "human_time_estimate": null,
      "human_total_time_spent": null
    },
    "task_completion_status": {
      "count": 0,
      "completed_count": 0
    },
    "blocking_issues_count": 0,
    "has_tasks": true,
    "task_status": "",
    "_links": {
      "self": "https://gitlab.com/api/v4/projects/75943662/issues/1",
      "notes": "https://gitlab.com/api/v4/projects/75943662/issues/1/notes",
      "award_emoji": "https://gitlab.com/api/v4/projects/75943662/issues/1/award_emoji",
      "project": "https://gitlab.com/api/v4/projects/75943662",
      "closed_as_duplicate_of": null
    },
    "references": {
      "short": "#1",
      "relative": "#1",
      "full": "cloudopsedge/tickets/support-infra#1"
    },
    "severity": "UNKNOWN",
    "moved_to_id": null,
    "imported": false,
    "imported_from": "none",
    "service_desk_reply_to": null
  }
]


// --- Helper to get project name from ID ---
// In a real application, you'd fetch this from the GitLab API or have it pre-loaded.
// For this example, we'll create a simple map.
const projectNames = {
  75943662: 'Support Infra',
  75943663: 'Another Project'
};

function getProjectNameById(projectId) {
  return projectNames[projectId] || `Project ${projectId}`;
}
// ------------------------------------------

function transformGitLabIssuesToMockData(gitlabIssues) {
  const allUniqueLabels = new Set();
  const projectsMap = new Map(); // Stores project data by project_id

  gitlabIssues.forEach(issue => {
    const projectId = issue.project_id;
    const issueLabels = issue.labels;

    // Ensure project exists in our map
    if (!projectsMap.has(projectId)) {
      projectsMap.set(projectId, {
        name: getProjectNameById(projectId),
        issuesByLabel: {}
      });
    }

    const projectData = projectsMap.get(projectId);

    // Increment counts for each label and track all unique labels
    issueLabels.forEach(label => {
      allUniqueLabels.add(label);
      projectData.issuesByLabel[label] = (projectData.issuesByLabel[label] || 0) + 1;
    });
  });

  // Convert Set of labels to an array
  const finalLabels = Array.from(allUniqueLabels);

  // Convert projectsMap values to an array and ensure all projects have all labels initialized
  const finalProjects = Array.from(projectsMap.values()).map(project => {
    const issuesByLabelWithAllLabels = {};
    // Initialize all possible labels for this project to 0
    finalLabels.forEach(label => {
      issuesByLabelWithAllLabels[label] = project.issuesByLabel[label] || 0;
    });

    return {
      name: project.name,
      issuesByLabel: issuesByLabelWithAllLabels
    };
  });

  return {
    labels: finalLabels,
    projects: finalProjects
  };
}

const transformedData = transformGitLabIssuesToMockData(mockGitlabIssues);
console.log(JSON.stringify(transformedData, null, 2));